<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>World War of Higher Education</title>

    <!-- Bootstrap Core CSS -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <!-- Theme CSS -->
    <link href="css/agency.css" rel="stylesheet">
    <link href="css/willy_map.css" rel="stylesheet">
    
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>
</head>

<body id="page-top" class="index">

    <!-- Navigation -->
    <nav id="mainNav" class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">CS + X</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#intro">Intro</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#statistics">Statistics</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#map">Map</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#team">Team</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="intro-text">
                <!-- <div class="intro-lead-in">Final Project Of Data Visualization by D3.js!</div> -->
                <div class="intro-heading">World War of <br/>Higher Education</div>
                <a href="#intro" class="page-scroll btn btn-xl">Learn More</a>
            </div>
        </div>
    </header>

    <!-- Intro Section -->
    <section id="intro">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Intro</h2>
                    <h3 class="section-subheading text-muted">Why we want to investigate this?</h3>
                </div>
            </div>
        </div>
    </section>

    <!-- Statistics Section -->
    <section id="statistics" class="bg-light-gray">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Statistics</h2>
                    <h3 class="section-subheading text-muted">Here we summary some statistics we found in the data.</h3>
                </div>
            </div>
            <div class="row">
                <div id="lilly" class="col-md-6 img-fluid"></div>
                <div id="lilly2" class="col-md-6 img-fluid"></div>
            </div>
            <div class="row">
                <div class="col-md-4 col-sm-6 portfolio-item">
                </div>
                <div class="col-md-4 col-sm-6 portfolio-item">
                </div>
                <div class="col-md-4 col-sm-6 portfolio-item">
                </div>
                <div class="col-md-4 col-sm-6 portfolio-item">
                </div>
                <div class="col-md-4 col-sm-6 portfolio-item">
                </div>
                <div class="col-md-4 col-sm-6 portfolio-item">
                </div>
            </div>
        </div>
    </section>

    <!-- Map Section -->
    <section id="map" style="height:1000px;">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Map</h2>
                    <h3 class="section-subheading text-muted">Here we show some maps we create to visualize the data.</h3>
                </div>
            </div>
            <div class="row">
              <div class="col-xs-12">
                <div class="button_label">
                  <button id="top100" onclick="showTopUniversities()">Top 100 Universties</button>
                  <button id="choro" onclick="showUniversityChoropleth()">Number of top 1000 universities for each country</button>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-12">
                  <div class="gradient_scale" id="grad_sc">
                    <p class="left sort_label" style="color: black;">Less</p>
                    <p class="right sort_label">More</p>
                  </div>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-12">
                <div id="willy_map_outer" height="1000">
                  <div id="willy_map"></div>
                </div>
                <div id="tooltip_top_100" class="hidden">
                      <div id="school_name">National Taiwan University</div>
                      <div>
                        <img src="" height="100" width="100" id="school_logo">
                      </div>
                      <div id="ranking">
                        <p class="university_tip">Rank among the top 100 universities: 
                          <strong><span id="ranking_text"></span></strong>
                        </p>
                      </div>
                      <div class="university_tip">
                        <a href="http://www.ntu.edu.tw"  id="school_website">http://www.ntu.edu.tw</a>
                      </div>
                </div>
                <div id="tooltip_choro" class="hidden">
                      <div id="country_name">Taiwan</div>
                      <div id="top_1000_num">
                        <p class="university_tip">Number of top 1000 universities: 
                          <strong><span id="top_1000_num_text"></span></strong>
                        </p>
                      </div>
                </div>
              </div>
            </div>
        </div>
    </section>
  <script>
  
    
    var width = 1024;
    var height = 768;
    
    var svg = d3.select("#willy_map").append("svg").attr("width",width).attr("height",height);

    var projection = d3.geoMercator()
      .scale(width / 2 / Math.PI)
      //.scale(100)
      .translate([width / 2, height / 2])

    var path = d3.geoPath()
      .projection(projection);
    
    var url = "world-110m.geojson";
    // Set the range and domain for color (scaleQuantize)
    var color = d3.scaleQuantize()
                  .range(["#F2C972", "#E6A74F",
                          "#DF8935", "#A35F28"]);
    
    // Hard-coded, too lazy to get data from csv
    var rScale = d3.scaleLinear()
        .range([6, 1])
        .domain([1,100]);

  d3.json(url, function(json) {
      svg.selectAll(".country")
          .data(json.features)
        .enter()
        .append("path")
        .attr("d", path)
        .attr("class", "country")
            .attr("stroke", "white")
            .attr("stroke-width", "0.5px")
            .attr("fill", "#E6A74E");
  });

    d3.csv("world_final.csv", function(data) {
              
      svg.selectAll("circle")
         .data(data)
         .enter()
         .append("circle")
         .attr("cx", function(d) {
           return projection([d.long, d.lat])[0];
         })
         .attr("cy", function(d) {
           return projection([d.long, d.lat])[1];
         })
         .on("mouseover", function(d) {
            // Change color
            d3.select(this).style("fill", "#4C2C00");
            
            //Get the circle's cx/cy values
          var xPosition = parseFloat(d3.select(this).attr("cx"));
          var yPosition = parseFloat(d3.select(this).attr("cy"));

          //Update the tooltip position and value
          var tooltip = d3.select("#tooltip_top_100");
          tooltip.classed("hidden", false);
          tooltip.transition()
                   .duration(500)    
                     .style("opacity", 0);
              tooltip.transition()    
                     .style("opacity", .9)
                     .style("left", xPosition + "px")
                 .style("top", yPosition + "px");    
            
          tooltip.select("#school_name")
                 .text(d.institution);

          tooltip.select("#ranking_text")
                 .text(d.world_rank);

          tooltip.select("#school_website")
                 .text(d.web_addr);

          tooltip.select("#school_website")
                 .attr('href', "http://" + d.web_addr)
          tooltip.select("#school_website")
                 .attr('target', "blank")

          tooltip.select("#school_logo")
                 .attr('src', "http://" + d.logo_source)


         })
         .on("mouseout", function(d) {
           d3.select(this).style("fill", "#9E7033");
           //Hide the tooltip
         //d3.select("#tooltip_top_100").classed("hidden", true);
         })
         .transition()
         .duration(750)
         .attr("r",0)
         .style("fill", "#9E7033")
         .attr("stroke", "white")
         .attr("stroke-width", "0.6")
         .style("opacity", 0.75)
    });


    function showTopUniversities(){
      //Remove mouseover and mouseout effect
      cancel_hover()
    //Hide previous tooltip
    d3.select("#tooltip_choro")
      .classed("hidden", true);

      svg.selectAll(".country")
         .transition()
       .duration(750)
         .attr("fill","#E6A74E")
         .style("opacity",1);

      d3.csv("world_final.csv", function(data) {
    svg.selectAll("circle")
       .transition()
       .duration(750)
       .attr("r",function(d) {
           return rScale(d.world_rank);
      });       
    });

      // Hide gradient scale
    document.getElementById("grad_sc").style.opacity = 0;
    }

    function cancel_hover(){
      d3.selectAll(".country")
          .on("mouseover", null)
          .on("mouseout", null);
    }

    function showUniversityChoropleth(){
      cancel_hover();
    // Hide the top 100 universities (circles)
    svg.selectAll("circle")
       .transition()
       .duration(750)
       .attr("r",0);

    // Hide tooltip
    d3.select("#tooltip_top_100")
      .classed("hidden", true);

    d3.csv("top_1000_summary.csv", function(data) {
          //console.log(data);
          data.forEach(function(d) {
            d.country = d.country;
            d.topUniversities = parseInt(d.topUniversities);
          })
          color.domain([d3.min(data, function(d) { return d.topUniversities; }),
                        d3.max(data, function(d) { return d.topUniversities; })]);
          
          // Add in the number of top universities for each country
          d3.json(url, function(json) {
              for(var i = 0; i < data.length; i++){
                var dataCountry = data[i].country;
                var dataTopUniversities = parseInt(data[i].topUniversities);
                //console.log(dataTopUniversities);
                for(var j = 0; j < json.features.length; j++){
                  var jsonCountry = json.features[j].properties.name;
                  if(dataCountry == jsonCountry){
                    json.features[j].properties.n_topUniversities = dataTopUniversities;
                    break;
                  }
                  //console.log(json.features[j].properties.n_topUniversities);
                }
              }
              //console.log("hey");
              svg.selectAll(".country")
                  .data(json.features)
                  .on("mouseover", function(d){
                       
                        // Add tool tip for choropleth
                var tooltip = d3.select("#tooltip_choro");
                tooltip.classed("hidden", false);
                tooltip.transition()
                          .duration(500)    
                          .style("opacity", 0);
                    tooltip.transition()    
                          .style("opacity", .9)
                          .style("left", (d3.event.pageX) + 20 + "px")
                            .style("top", (d3.event.pageY) - 30 + "px");   
                tooltip.select("#country_name")
                    .text(d.properties.name);
                tooltip.select("#top_1000_num_text")
                    .text(d.properties.n_topUniversities);

                // Fade out other countries when hovered upon
                          d3.selectAll(".country")
                          .transition()
                          .duration(100)
                          .style("opacity", .5);
                        d3.select(this)
                          .transition()
                          .duration(250)
                          .style("opacity", 1);
              })
              .on("mouseout", function(d){
                        d3.selectAll(".country")
                          .transition()
                          .duration(100)
                          .style("opacity", 1);
                    })
              .transition()
                    .duration(750)
                    .attr("fill", function(d) {
                          var n_topUniversities = d.properties.n_topUniversities;
                              if(n_topUniversities){
                                //console.log("found");
                                return color(n_topUniversities);
                              }
                              else{
                                //console.log("nothing");
                                return "#F8F3A5";
                              }           
                });
            //console.log("hi");
            });
      });
    document.getElementById("grad_sc").style.opacity = 0.9;
    
    //console.log("dafuq");
    }


  </script>
    <!-- Team Section -->
    <section id="team" class="bg-light-gray">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">Our Team Members</h2>
                    <h3 class="section-subheading text-muted">We are members from different departments and create all these beautiful things.</h3>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-4">
                    <div class="team-member">
                        <img src="img/team/yi.jpg" class="img-responsive img-circle" alt="">
                        <h4>Yi Hsiao</h4>
                        <p class="text-muted">NTUBEBI</p>
                        <ul class="list-inline social-buttons">
                            <li><a here="mailto:hsiaoyi0504@gmail.com"><i class="fa fa-envelope"></i></a>
                            </li>
                            <li><a href="https://www.facebook.com/yi.hsiao.7"><i class="fa fa-facebook"></i></a>
                            </li>
                            <li><a href="https://github.com/hsiaoyi0504"><i class="fa fa-github"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="team-member">
                        <img src="img/team/lilly.jpg" class="img-responsive img-circle" alt="">
                        <h4>Pei-Chun Hsieh</h4>
                        <p class="text-muted">NTUESOE</p>
                        <ul class="list-inline social-buttons">
                            <li><a here="#"><i class="fa fa-envelope"></i></a>
                            </li>
                            <li><a href="https://www.facebook.com/lily.hsieh.5203"><i class="fa fa-facebook"></i></a>
                            </li>
                            <li><a href="https://github.com/chunchun0217"><i class="fa fa-github"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="team-member">
                        <img src="img/team/kao.jpg" class="img-responsive img-circle" alt="">
                        <h4>Wei-Li Kao</h4>
                        <p class="text-muted">NTUIM</p>
                        <ul class="list-inline social-buttons">
                            <li><a here="#"><i class="fa fa-envelope"></i></a>
                            </li>
                            <li><a href="#"><i class="fa fa-facebook"></i></a>
                            </li>
                            <li><a href="https://github.com/b02705006"><i class="fa fa-github"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-4">
                    <div class="team-member">
                        <img src="img/team/luo.jpg" class="img-responsive img-circle" alt="">
                        <h4>Hao Luo</h4>
                        <p class="text-muted">NTUEE</p>
                        <ul class="list-inline social-buttons">
                            <li><a here="#"><i class="fa fa-envelope"></i></a>
                            </li>
                            <li><a href="https://www.facebook.com/profile.php?id=100000686967264"><i class="fa fa-facebook"></i></a>
                            </li>
                            <li><a href="https://github.com/laco666"><i class="fa fa-github"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-4">
                    <div class="team-member">
                        <img src="img/team/lin.jpg" class="img-responsive img-circle" alt="">
                        <h4>Ting-Kai Lin</h4>
                        <p class="text-muted">NTUESOE</p>
                        <ul class="list-inline social-buttons">
                            <li><a here="#"><i class="fa fa-envelope"></i></a>
                            </li>
                            <li><a href="https://www.facebook.com/profile.php?id=100001631111313"><i class="fa fa-facebook"></i></a>
                            </li>
                            <li><a href="https://github.com/BensonTKLin"><i class="fa fa-github"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <span class="copyright">Copyright &copy; NTU Data Visualization by D3.js Group 4 2016-2017
                    </span>
                </div>
                <div class="col-md-6">
                    <ul class="list-inline quicklinks">
<!--                         <li><a href="#">Privacy Policy</a>
                        </li>
                        <li><a href="#">Terms of Use</a>
                        </li> -->
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!-- Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Theme JavaScript -->
    <script src="js/agency.min.js"></script>

</body>

</html>
